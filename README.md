## Monorepo by pnpm

í”„ë¡œì íŠ¸ ìˆ˜í–‰ê¸°ê°„: 2024-05-12 ~

## ğŸ› ï¸ ì‚¬ìš©ê¸°ìˆ 

- pnpm

## ğŸ—ï¸ ì•„í‚¤í…ì³

```
root/
â”œâ”€â”€ apps/
â”‚ â”œâ”€â”€ react-apps
| â”œâ”€â”€ ...
â”œâ”€â”€ packages/
â”‚ â”œâ”€â”€ shared
â”‚ â”œâ”€â”€ utils
â”œâ”€â”€ pnpm-workspace.yaml
â”œâ”€â”€ tsconfig.base.json
```

**apps** - ì†Œë¹„ììš© í”„ë¡œì íŠ¸

**packages/shared** - ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸ (ex. Button, Typography, ...)

**packages/utils** - ì¬ì‚¬ìš© ë¡œì§

**pnpm-workspace** - pnpm workspace ë“±ë¡ íŒŒì¼ (apps, packages ë“±ë¡)

**tsconfig.base.json** - ê° í”„ë¡œì íŠ¸ë³„ ê¸°ë³¸ ts ì»´íŒŒì¼ ì„¤ì •

## âœ¨ ì£¼ìš”ê¸°ëŠ¥

### 1. pnpmì˜ ë¹ ë¥¸ ì†ë„, íš¨ìœ¨ì ì¸ ë°©ì‹ì˜ íŒ¨í‚¤ì§€ ê´€ë¦¬

pnpmì€ `package.json`ì— ëª…ì‹œëœ íŒ¨í‚¤ì§€ë¥¼ ì½ì€ í›„ `node_moduels`ì— symbolic Link(symlink)ì„ ìƒì„±í•˜ì—¬ ì „ì—­ ì €ì¥ì†Œì˜ í•´ë‹¹ íŒ¨í‚¤ì§€ë¥¼ ì°¸ì¡°í•˜ì—¬ disk ë‚­ë¹„ë¥¼ ì¤„ì…ë‹ˆë‹¤.

### 2. ê°„ë‹¨í•œ ëª¨ë…¸ë ˆí¬ ì„¤ì •

pnpm-workspaceëŠ” ê°„ë‹¨í•˜ê²Œ ëª¨ë…¸ë ˆí¬ ì„¤ì •ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `pnpm-workspcae.yaml` íŒŒì¼ì— ëª¨ë…¸ë ˆí¬ë¥¼ ì ìš©í•  í´ë”ë¥¼ ëª…ì‹œí•˜ê³  `package.json`ì— ê°„ë‹¨í•œ ì„¤ì •ì„ í•´ ì£¼ë©´ ëì…ë‹ˆë‹¤. ë§Œë“¤ì–´ì§„ íŒ¨í‚¤ì§€ë“¤ì€ ìë™ìœ¼ë¡œ ë§í¬ë˜ê¸°ì— ë³„ë„ë¡œ ì„¤ì¹˜ë‚˜ ì—°ê²°í•´ì¤„ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

## ğŸ“¦ ì„¤ì¹˜ ë° ì‚¬ìš©ë°©ë²•

### 1. git clone

```
git clone https://github.com/hansolc/monorepo-pnpm.git
```

### 2. ë°°í¬ í”„ë¡œì íŠ¸ ì„¤ì •

apps í´ë” ë‚´ì— í”„ë¡œì íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤(CRA or Vite ì‚¬ìš© ê°€ëŠ¥). ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `package.json` íŒŒì¼ì— `@monorepo-pnpm/shared: workspace:*`ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

### 3. ì¬ì‚¬ìš© ì»´í¬ë„ŒíŠ¸ ì¶”ê°€

`packages/shared` ì˜ `component` íŒŒì¼ì— ê° í”„ë¡œì íŠ¸ë§ˆë‹¤ ì¬ì‚¬ìš©í•  ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì¶”ê°€í›„, index.ts íŒŒì¼ì— exportí•´ì£¼ì„¸ìš”.

### 4. Storybook ì‹¤í–‰

`packages/shared`ì˜ ì»´í¬ë„ŒíŠ¸ ì´í•´ë¥¼ ìœ„í•´ storybookì€ `dev:shared-stories`ë¡œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.

## â™»ï¸ íŒ¨í‚¤ì§€ ìˆ˜ì • ì‹œ ì•±ì—ì„œ ì¦‰ì‹œ ë°˜ì˜ë˜ë„ë¡ Vite HMR ì„¤ì •í•˜ê¸°

### With React-Vite

> ëª¨ë…¸ë ˆí¬ í™˜ê²½ì—ì„œ packages ë””ë ‰í† ë¦¬ì˜ ì»´í¬ë„ŒíŠ¸ ë˜ëŠ” ìœ í‹¸ í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•œ í›„, apps í”„ë¡œì íŠ¸ì—ì„œ ì§ì ‘ ë¹Œë“œí•˜ì—¬ í™•ì¸í•˜ëŠ” ê³¼ì •ì€ ë²ˆê±°ë¡­ê³  ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.
> ì´ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´, Vite í™˜ê²½ì—ì„œ ê°œë°œ ì¤‘ ë³€ê²½ ì‚¬í•­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

### `vanilla-extract` í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€(ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©ì‹œ) & `resolve.alias`ë¡œ íŒ¨í‚¤ì§€ ì°¸ì¡° ì—°ê²° (in `vite.config.ts`)

- ê³µìœ  ì»´í¬ë„ŒíŠ¸ì˜ ìŠ¤íƒ€ì¼ì´ vanilla-extract/cssë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´, ì‹¤ì‹œê°„ ë°˜ì˜ì„ ìœ„í•´ Vite í”ŒëŸ¬ê·¸ì¸ ë“±ë¡ì´ í•„ìš”í•©ë‹ˆë‹¤.

- resolve.alias ë‚´ì— ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” ê²½ë¡œ ë° ì´ë¦„ì— ë§ê²Œ ì¡°ì •í•´ ì£¼ì„¸ìš”.

ì´ ì„¤ì •ì„ í†µí•´ í•´ë‹¹ ê²½ë¡œì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì§ì ‘ ì°¸ì¡°í•˜ê²Œ ë˜ì–´, ë¹Œë“œ ì—†ì´ ë³€ê²½ì‚¬í•­ì„ ë°”ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
import { vanillaExtractPlugin } from "@vanilla-extract/vite-plugin";

// https://vite.dev/config/
export default defineConfig({
  plugins: [react(), tailwindcss(), vanillaExtractPlugin()],
  resolve: {
    alias: {
      "@packages/shared": path.resolve(
        __dirname,
        "../../packages/shared/src/index.ts"
      ),
    },
  },
});

```
